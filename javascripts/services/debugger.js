define(["easyAlgoParser","easyAlgoRunner"],function(t,n){function x(e,t){function o(e){n[i].top=Math.max(0,e.clientY-n.offsetHeight-5)+"px",n[i].left=e.clientX+5+"px"}var n=document.createElement("div");return n.className="CodeMirror-lint-tooltip",typeof t=="string"&&(t=document.createTextNode(t)),n[r](t),document.body[r](n),o(e),n[i][s]!=null&&(n[i][s]=1),n}function T(e){e[o]&&e[o].removeChild(e)}function N(e){if(!e[o])return;e[i][s]==null&&T(e),e[i][s]=0,setTimeout(function(){T(e)},600)}function C(e,t){CodeMirror.off(e,u,C),CodeMirror.off(e,"click",C),t&&N(t)}var r="appendChild",i="style",s="opacity",o="parentNode",u="mouseout",a="wraper",f="mouseover",l="context",c="cursorActivity",h="lastSelectedMarked",p="indexFromPos",d="anchor",v="_lastTimeOut",m="lastTooltip",g="prototype",y="lastMarked",b="needToFinish",w="posFromIndex",E="commandName",S="nextLine",k=function(r){this.cm=r,this[a]=r.getWrapperElement();var i=this,s=undefined,o=undefined;this[f]=function(t){var n=t;i.mousePos=n;var r=t.srcElement||e.target;i.span=r;if(r.className.indexOf("cm-variable")>=0){var s=i[l];if(!s)return undefined;var o=s.getValue(r.innerText.toUpperCase());o===undefined?o="non definie":Array.isArray(o)?o="["+o.join("; ")+"]":typeof o=="boolean"&&(o=o?"vrai":"faux");var a=x(t,o+"");CodeMirror.on(r,u,function(){C(r,a)})}},this[c]=function(e){i[h]&&i[h].clear();var r=i.cm.listSelections()[0],s=i.cm[p](r[d]),o=i.cm[p](r.head);if(o<s){var u=r.head;r.head=r[d],r[d]=u}i[h]=i.cm.markText(r[d],r.head,{className:"CodeMirror-selected"}),i[v]&&clearTimeout(i[v]),i[m]&&C(i.span,i[m]);var a=i.mousePos,f=i.span;i[v]=setTimeout(function(){var r=function(e){i[m]=x(a,"("+s+") => "+e+"")},s=e.getSelection(),o=new t(undefined,undefined,i[l]),u=o.parse("ECRIRE "+s+"\n"),f=new n({error:r,write:r});f.run(u.result,undefined,i[l])},200)},r.on(c,this[c]),CodeMirror.on(this[a],f,this[f])};return k[g].setRunner=function(e){this.runner=e;var t=this;e.addEndHandler(function(){t.end()})},k[g].end=function(){CodeMirror.off(this[a],f,this[f]),this.cm.off(c,this[c]),this[y]&&this[y].clear()},k[g].debug=function(e,t,n){this[y]&&this[y].clear();if(this[b]){e();return}this[l]=n;var r=this.cm[w](t.offset.begin),i=this.cm[w](t.offset.end);this[y]=this.cm.markText(r,i,{className:"currently-running"}),this.cm.scrollIntoView(r),t[E]=="read"||t[E]=="define"||t.type=="defineFunction"?e():this[S]=e},k[g].next=function(){var e=this[S];this[S]=undefined,e&&e()},k[g].finish=function(){this[b]=!0,this.next()},k});