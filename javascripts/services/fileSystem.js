define(["ffFileSystem"],function(){var t="requestQuota",n="log",r="root",i="/",s="getDirectory",o=!0,u="length",a="getFile",f=window.requestFileSystem||window.webkitRequestFileSystem,l=navigator.webkitPersistentStorage,c={isSupported:function(){return f!==undefined},initFs:function(r,i,s){var o=this;l&&l[t]?l[t](r,function(e){f(PERSISTENT,r,function(e){o.init(e),i&&i(o)},function(e){console[n](e),s&&s(e)})},function(e){console[n]("Error",e),s&&s(e)}):f(PERSISTENT,r,function(e){c.init(e),i&&i(o)},function(t){console[n](t),s&&s(e)})},init:function(e){this.fs=e},mkdir:function(e,t,a){var f=this;a=a||this.fs[r];var l=e.split(i);a[s](l[0],{create:o},function(e){l[u]>1?f.mkdir(l.slice(1).join(i),t,e):t(e)},function(e){console[n](e)})},listDir:function(e,t,o,a){var f=this;a=a||this.fs[r];var l=e.split(i);a[s](l[0],{},function(e){if(l[u]>1)f.listDir(l.slice(1).join(i),t,o,e);else{var r=e.createReader();r.readEntries(function(e){var n=[];e[u]?n=e:e.forEach(function(e,t){n.push(e)}),t(n)},function(e){console[n](e),o&&o(e)})}},function(e){console[n](e),o&&o(e)})},touch:function(e,t,i,s){s=s||this.fs[r];var u=this;s[a](e,{create:o,exclusive:o},function(e){t(e)},function(e){console[n](e),i&&i(e)})},readFile:function(e,t,i){i=i||this.fs[r];var s=this;i[a](e,{},function(e){e.file(function(e){s.readyFileEntry(e)})},function(e){console[n](e)})},readFileEntry:function(e,t){e.file(function(e){var n=new FileReader;n.onloadend=function(e){t(e.target.result)},n.readAsText(e)})},writeFile:function(e,t,i){i=i||this.fs[r];var s=this;i[a](e,{},function(e){e.createWriter(function(e){e.onwriteend=function(){e[u]===0&&e.write(new Blob([t]))},e.truncate(0)})},function(e){console[n](e)})},removeFile:function(e,t){this.fs[r][a](e,{},function(e){e.remove(function(){t&&t()})},function(r){console[n](r,e),t&&t()})}};return c});