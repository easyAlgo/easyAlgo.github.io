define(["app","easyAlgoConfiguration","easyAlgoParser","controllers/popUp"],function(e,t,n){var r="length",i="trim",s="isEmpty",o="varname",u="array",a="arrayType",f=!1,l="expression",c="name",h="elseReturn",p="replace",d='"',v="escapeString",m="definir ",g="message",y="number",b="boolean",w="arrayValues",E="refactorExpression",S="; ",x="substring",T="\n",N="	",C="tabulate",k=!0,L="pour ",A="// code executé pour chaques element du tableau",O="\nfin_pour",M="	retourner ",_="\nfin_fonction",D="definir_fonction ",P="help",H="functions",B="selected",j="isValidated",F="arrayCurrentValue",I="line",q="head",R="anchor",U={isEmpty:function(e){return e==undefined||e[i]()[r]==0},define:function(e){return!this[s](e[o])&&!this[s](e.type)},read:function(e){return!this[s](e[o])},afectation:function(e){if(e.varType==u){if(!e[a])return f;if(e[a]==3&&!e[l])return f}return e[o]!=undefined},"if":function(e){return!this[s](e.test)},"while":function(e){return!this[s](e.test)},foreach:function(e){return!this[s](e[o])&&!this[s](e[u])},"for":function(e){return!this[s](e[o])&&!this[s](e.start)&&!this[s](e.end)},functionSimple:function(e){return!this[s](e[c])&&!this[s](e[l])},functionConditional:function(e){return!this[s](e[c])&&!this[s](e.paramType)&&!this[s](e[h])},"function":function(e){return!this[s](e[c])}},z={tabulate:function(e){return e[p](/\n/g,"\n	")},escapeString:function(e){return e[p](/"/g,'\\"')},refactorExpression:function(e,t){var r=new n(undefined,undefined,e);r.initParser(t);try{r.parseExpression()}catch(i){return d+this[v](t)+d}return t},define:function(e,t){return{code:m+t[o]+" "+t.type}},read:function(e,t){return{code:"lire "+t[o]}},afectation:function(e,t){var n=t.varType,i=undefined;console.log(n);if(n=="string"&&t[g])i=d+this[v](t[g])+d;else if(n==y&&t[y])i=t[y];else if(n==b&&t[b])i=t[b];else if(n==u)if(t[a]==1){i="[";if(t[w]){for(var s in t[w])i+=this[E](e,t[w][s])+S;i=i[x](0,i[r]-2)}i+="]"}else if(t[a]==2){i="[";if(t[w]){for(var s in t[w]){var f=t[w][s];i+=this[E](e,f.key)+" : "+this[E](e,f.value)+S}i=i[x](0,i[r]-2)}i+="]"}else t[a]==3&&(t[o]+="["+(t.index||"")+"]");return i||(i=this[E](e,t[l])),{code:t[o]+" = "+i}},write:function(e,t){var n=undefined;return t[g]&&(n=d+this[v](t[g])+d),n||(n=this[E](e,t[l])),{code:"ecrire "+n+(t.output?" '"+t.output+"'":"")}},"if":function(e,t,n){var r="si "+t.test+T;return n?r+=N+this[C](n[i]()):r+=N+"// code si le test est vrai",t.elseBlock&&(r+="\nSI_NON\n	//code si le test est faux"),r+="\nFIN_SI",{overrideSelection:k,code:r}},"while":function(e,t,n){var r="tant_que "+t.test+T;return n?r+=N+this[C](n[i]()):r+=N+"// code executé dans la boucle",r+="\nfin_tant_que",{overrideSelection:k,code:r}},foreach:function(e,t,n){var r="";return e.isset(t[o],f)||(r=m+t[o]+" chaine // attention vérifier le type de la variable \n"),r+=L+t[o]+" dans "+t[u]+T,n?r+=N+this[C](n[i]()):r+=N+A,r+=O,{overrideSelection:k,code:r}},"for":function(e,t,n){var r="";return e.isset(t[o],f)||(r=m+t[o]+" nombre\n"),r+=L+t[o]+" de "+t.start+" a "+t.end,t.step&&(r+=" par "+t.step),r+=T,n?r+=N+this[C](n[i]()):r+=N+A,r+=O,{overrideSelection:k,code:r}},functionSimple:function(e,t){var n="// "+t[c]+"(x) = "+t[l];return n+="\ndefinir_fonction "+t[c]+"(x : nombre)\n",n+=M+t[l],n+=_,{overrideSelection:f,code:n,addAtStart:k}},functionConditional:function(e,t){var n=D+t[c]+"(x : "+t.paramType+")\n";if(t[w]){for(var r in t[w]){var i=t[w][r];n+="	si"+(r==0?" ":"_non_si ")+i.condition+T,n+="		retourner "+i[l]+T}n+="	fin_si\n"}return n+=M+t[h],n+=_,{overrideSelection:f,code:n,addAtStart:k}},"function":function(e,t){var n=D+t[c]+"(";if(t[w]){for(var i in t[w]){var s=t[w][i];n+=s[c]+" : "+s.type+S}n=n[x](0,n[r]-2)}return n+=")\n",n+="	// code de la fonction\n",n+='	retourner ""//compléter la fonction avec la valeur à retourner',n+=_,{overrideSelection:f,code:n,addAtStart:k}}};e.controller("editorInstructionPopUp",["$scope","$modalInstance","$controller","$timeout","codeMirror",function(e,s,o,u,a){angular.extend(this,o("popUpController",{$scope:e,$modalInstance:s,title:"",message:"",buttons:{}})),e.sections={Instruction:{"Définir une variable":{id:"define",title:"Définir une variable"},"Lire une variable":{id:"read",title:"Lire une variable"},"Ecrire un message":{id:"write",title:"Ecrire un message"},"Afecter une variable":{id:"afectation",title:"Afectation d'une variable"},position:1},"Structure conditionelle":{Si:{id:"if",title:"Condition"},position:2},"Structure itérative":{"Execution tant que vrai":{id:"while",title:"Boucle tant que"},"Parcour entre deux nombres":{id:"for",title:"Boucle pour"},"Parcour d'un tableau":{id:"foreach",title:"Boucle pour chaque"},position:3},Fonctions:{"Fonction simple":{id:"functionSimple",title:"Fonction simple"},"Fonction conditionnel":{id:"functionConditional",title:"Fonction conditionnel"},Fonction:{id:"function",title:"Fonction"}},Aide:{"Liste de fonctions":{type:P,id:H,title:"Fonctions"},"Liste des variables":{type:P,id:"variables",title:"Variables"},position:5}},e.configuration=t,e[B]=undefined,e.setSelected=function(t){t.type==P?e[P]=t:(e[B]&&(e[B][B]=f),e[B]=t,t[B]=k,e[j]=f)},e.closeHelp=function(){e[P]=undefined};var l=new n,c=l.parse(a.getValue()),h=a.indexFromPos(a.getCursor()),d=c.context.getContextFor(h);console.log(c.context),e.vars=d.getAccessibleVars(),e[H]=t.getFunctions(),e.accessibleFunctions=d.getAccessibleFunctions(),console.log(e[H]),e.functionsDescription=t.getFunctionsDescription(),e.removeArray=function(t){e[B][w].splice(t,1)},e.addArrayValue=function(t){if(!e[B][F])return;e[B][w]==undefined&&(e[B][w]=[]),e[B][w].push(e[B][F]),e[B][F]=undefined},e.validateForm=function(){e[j]=k;var t=e[B]||{};if(t.id in U){var n=U[t.id](t);return n}return k},s.result.then(function(){function t(e){var t="";for(var n=0;n<e;++n)t+=" ";return t}if(!e[B]||!(e[B].id in z))return;var n=a.getMode({},"easyAlgo");u(function(){var s=a.listSelections()[0],o=e[B]||{},u=undefined;if(s[q][I]!=s[R][I]||s[q].ch!=s[R].ch){var l=CodeMirror.Pos(s[q][I],0),c=a.getLine(s[R][I]),h=CodeMirror.Pos(s[R][I],c[r]);u=a.getRange(l,h)}var v=z[o.id](d,o,u),m=v.code,g=v.overrideSelection||f,y=v.addAtStart,b=s[q],w=s[q];g&&u?(b=l,w=h):y&&(b={ch:0,line:0},w=b);var E=a.getTokenAt(b),S=n.indent(E.state,m),x=t(S);m=x+m,m=m[p](/\n/g,T+x);var N=a.getRange(CodeMirror.Pos(b[I],0),b),C=a.getLine(b[I]);N[i]()[r]>0?(b.ch=C[r],m=T+m):C[i]()[r]>0?(b.ch=0,m+=g?"":T):b.ch=0,a.replaceRange(m,b,w),a.setSelection(b,b)})})}])});