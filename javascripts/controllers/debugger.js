define(["easyAlgoParser","easyAlgoRunner"],function(t,n){function r(e,t){function n(e){r[a].top=Math.max(0,e.clientY-r.offsetHeight-5)+"px",r[a].left=e.clientX+5+"px"}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",typeof t=="string"&&(t=document.createTextNode(t)),r[u](t),document.body[u](r),n(e),r[a][f]!=null&&(r[a][f]=1),r}function i(e){e[l]&&e[l].removeChild(e)}function s(e){if(!e[l])return;e[a][f]==null&&i(e),e[a][f]=0,setTimeout(function(){i(e)},600)}function o(e,t){CodeMirror.off(e,c,o),CodeMirror.off(e,"click",o),t&&s(t)}var u="appendChild",a="style",f="opacity",l="parentNode",c="mouseout",h="wraper",p="mouseover",d="context",v="cursorActivity",m="lastSelectedMarked",g="indexFromPos",y="anchor",b="_lastTimeOut",w="lastTooltip",E="prototype",S="lastMarked",x="needToFinish",T="posFromIndex",N="commandName",C="nextLine",k=function(i){this.cm=i,this[h]=i.getWrapperElement();var s=this,u=undefined,a=undefined;this[p]=function(t){var n=t;s.mousePos=n;var i=t.srcElement||e.target;s.span=i;if(i.className.indexOf("cm-variable")>=0){var u=s[d];if(!u)return undefined;var a=u.getValue(i.innerText.toUpperCase());a===undefined?a="non definie":Array.isArray(a)?a="["+a.join("; ")+"]":typeof a=="boolean"&&(a=a?"vrai":"faux");var f=r(t,a+"");CodeMirror.on(i,c,function(){o(i,f)})}},this[v]=function(e){s[m]&&s[m].clear();var i=s.cm.listSelections()[0],u=s.cm[g](i[y]),a=s.cm[g](i.head);if(a<u){var f=i.head;i.head=i[y],i[y]=f}s[m]=s.cm.markText(i[y],i.head,{className:"CodeMirror-selected"}),s[b]&&clearTimeout(s[b]),s[w]&&o(s.span,s[w]);var l=s.mousePos,c=s.span;s[b]=setTimeout(function(){var i=function(e){s[w]=r(l,"("+o+") => "+e+"")},o=e.getSelection(),u=new t(undefined,undefined,s[d]),a=u.parse("ECRIRE "+o+"\n"),f=new n({error:i,write:i});f.run(a.result,undefined,s[d])},200)},i.on(v,this[v]),CodeMirror.on(this[h],p,this[p])};return k[E].setRunner=function(e){this.runner=e;var t=this;e.addEndHandler(function(){t.end()})},k[E].end=function(){CodeMirror.off(this[h],p,this[p]),this.cm.off(v,this[v]),this[S]&&this[S].clear()},k[E].debug=function(e,t,n){this[S]&&this[S].clear();if(this[x]){e();return}this[d]=n;var r=this.cm[T](t.offset.begin),i=this.cm[T](t.offset.end);this[S]=this.cm.markText(r,i,{className:"currently-running"}),this.cm.scrollIntoView(r),t[N]=="read"||t[N]=="define"||t.type=="defineFunction"?e():this[C]=e},k[E].next=function(){var e=this[C];this[C]=undefined,e&&e()},k[E].finish=function(){this[x]=!0,this.next()},k});